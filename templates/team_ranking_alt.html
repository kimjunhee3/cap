<script>
(function () {
  // URL 파라미터
  const usp = new URLSearchParams(location.search);
  const urlTeam = (usp.get('team') || '').trim();
  const autoSelect = usp.get('auto_select') === '1';
  const isEmbed = usp.get('embed') === '1';

  // 슬러그 → 화면 표기명 매핑
  const mapToDisplay = {
    'KT':'KT','kt':'KT','wiz':'KT','ktwiz':'KT','케이티':'KT',
    'LG':'LG','lg':'LG','엘지':'LG',
    'KIA':'KIA','kia':'KIA','기아':'KIA',
    'SSG':'SSG','ssg':'SSG','sk':'SSG','wyverns':'SSG','와이번스':'SSG','랜더스':'SSG',
    'NC':'NC','nc':'NC','엔씨':'NC','dinos':'NC',
    '두산':'두산','doosan':'두산','Doosan':'두산','ob':'두산',
    '한화':'한화','hanwha':'한화','Hanwha':'한화',
    '키움':'키움','kiwoom':'키움','히어로즈':'키움','넥센':'키움','woori':'키움',
    '삼성':'삼성','samsung':'삼성','Samsung':'삼성',
    '롯데':'롯데','lotte':'롯데','Lotte':'롯데','giants':'롯데'
  };
  const toDisplayName = (x) => {
    if (!x) return '';
    const k = String(x).trim();
    return mapToDisplay[k] ?? mapToDisplay[k.toLowerCase()] ?? k;
  };

  // 임베드 모드 약간의 스타일
  if (isEmbed) document.body.style.background = 'transparent';

  // 높이 postMessage (항상 동작)
  function postHeight() {
    try {
      const h = Math.max(
        document.documentElement.scrollHeight || 0,
        document.body.scrollHeight || 0,
        600
      );
      parent.postMessage({ type: 'resize-team-ranking', height: h }, '*');
    } catch (e) {}
  }
  window.addEventListener('load', postHeight);
  window.addEventListener('resize', () => requestAnimationFrame(postHeight));
  setTimeout(postHeight, 300);

  // ✅ 여기서부터는 요소가 있을 때만 실행 (없으면 조용히 종료)
  const selectEl = document.getElementById('team-select');
  if (!selectEl) {
    console.warn('[team-ranking] #team-select not found — skipping init.');
    return;
  }

  function highlight(selected) {
    document.querySelectorAll('tbody tr').forEach(tr => {
      tr.classList.toggle('selected-row', tr.getAttribute('data-team') === selected);
    });
    requestAnimationFrame(postHeight);
  }

  // 드롭다운 변경 이벤트 (요소가 있을 때만 등록)
  selectEl.addEventListener('change', function () {
    highlight(this.value);
  });

  // 자동 선택
  const want = toDisplayName(urlTeam);
  if (autoSelect && want) {
    selectEl.value = want;
    highlight(want);
  }
})();
</script>
